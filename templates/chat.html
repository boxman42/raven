{% extends "base.html" %}
{%block content %}
<!-- python froms -->
{{ form.csrf_token }}
{{ form.hidden_tag() }}
<form action="#" method="post">
    <main class="d-flex flex-nowrap">
        <!-- side bar -->
        <div class="d-flex flex-column flex-shrink-0 p-3 text-bg-dark bottom-0" style="width: 280px; height: 100vh;">
            <h1>Extra info</h1>
            <hr>
            <ul class="nav nav-pills flex-column gap-3 mb-auto">
                <li class="nav-item">
                    <div class="form-group">
                        {{ form.chat2.label(for="chat2", class="form-label") }}
                        {{ form.chat2(id="chat2", class="form-control", placeholder="put text here")}}
                    </div>
                </li>
                <li class="nav-item">
                    <div class="form-group">
                        {{ form.chat3.label(for="chat3", class="form-label") }}
                        {{ form.chat3(id="chat3", class="form-control", placeholder="put text here")}}
                    </div>
                </li>
            </ul>
        </div>
        <!-- main body -->
        <div class="container-fluid">
            <!-- the scrolly chat bit -->
            <div class="chat-container">
                <h1>ChatNPC</h1>
                <div id="chatbox">
                    <ul id="message-list">
                        <!-- Chatbot responses and user messages will be displayed here -->
                    </ul>
                </div>
    
                <div id="thinking-animation" style="display: none;">
                    <div class="thought-bubble">
                        <div class="dot dot1"></div>
                        <div class="dot dot2"></div>
                        <div class="dot dot3"></div>
                    </div>
                </div>
    
                <form id="chat-form">
                    <div class="input-box">
                        <input type="text" id="user-input" name="user_input" disabled>
                        <input type="submit" id="send-button" value="Send" disabled>
                        <!-- <button id="run-script-button">Clean Slate Protocol</button> -->
                    </div>
                </form>
    
                <audio autoplay id="auto-play-audio">
                    <!-- Initially, the source is set to a placeholder URL; it will be updated dynamically in JavaScript -->
                    <source src="" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
            </div>
            <div id="popup-container">
                <p id="popup-message">Select a character</p>
                <button id="close-popup-btn">X</button>
            </div>
            <!-- Include the chat.js JavaScript file -->
            <script src="{{ url_for('static', filename='chat.js') }}"></script>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    // Add event listener to sidebar buttons
                    const sidebarButtons = document.querySelectorAll('.sidebar li');
                    sidebarButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            // Reset styles for all buttons
                            sidebarButtons.forEach(btn => {
                                btn.style.backgroundColor = '';
                                btn.style.color = '';
                            });
        
                            // Apply styles for clicked button
                            this.style.backgroundColor = 'white';
                            this.style.color = 'black';
                        });
                    });
                });
            </script> <!-- script to swap background and text colour of sidebar buttons -->
            <!-- this the main chat -->
            <div class="form-group">
                <div class="form-floating">
                    {{ form.chat1(id="chat1", class="form-control", placeholder="put text here")}}
                    {{ form.chat1.label(for="chat1", class="form-label") }}
                    {{ form.submit(for="chat1", class="btn btn-primary btn-lg") }}
                </div>
            </div>
        </div>
    </main>
</form>


{% endblock %}